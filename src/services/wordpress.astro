---
import type { Post } from '../models/wordpress';

export async function obtenerPosts(): Promise<Post[]> {
    const url = 'https://blog.redflox.com/wp-json/wp/v2/posts?_embed';
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs');
    }
    return respuesta.json() as Promise<Post[]>;
}

export async function obtenerPost(slug: string): Promise<Post> {
    const url = `https://blog.redflox.com/wp-json/wp/v2/posts?slug=${slug}&_embed`;
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar el blog');
    }
    const posts = await respuesta.json() as Post[];
    if (posts.length === 0) {
        throw new Error('No se encontró el blog');
    }
    return posts[0];
}

export async function obtenerPostsPorCategoria(categoria: string): Promise<Post[]> {
    const url = `https://blog.redflox.com/wp-json/wp/v2/posts?categories=${categoria}&_embed`;
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs');
    }
    return respuesta.json() as Promise<Post[]>;
}

export async function obtenerPostsPorEtiqueta(etiqueta: string): Promise<Post[]> {
    const url = `https://blog.redflox.com/wp-json/wp/v2/posts?tags=${etiqueta}&_embed`;
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs');
    }
    return respuesta.json() as Promise<Post[]>;
}

export async function obtenerCategorias(): Promise<{ id: number, name: string }[]> {
    const url = 'https://blog.redflox.com/wp-json/wp/v2/categories';
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar las categorías');
    }
    return respuesta.json() as Promise<{ id: number, name: string }[]>;
}

export async function obtenerEtiquetas(): Promise<{ id: number, name: string }[]> {
    const url = 'https://blog.redflox.com/wp-json/wp/v2/tags';
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar las etiquetas');
    }
    return respuesta.json() as Promise<{ id: number, name: string }[]>;
}

export async function obtenerPostsRelacionados(post: Post): Promise<Post[]> {
    const url = `https://blog.redflox.com/wp-json/wp/v2/posts?categories=${post.categories[0]}&per_page=3&_embed`;
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs relacionados');
    }
    return respuesta.json() as Promise<Post[]>;
}

export async function obtenerPostsPopulares(): Promise<Post[]> {
    const url = 'https://blog.redflox.com/wp-json/wp/v2/posts?orderby=meta_value_num&meta_key=post_views_count&order=desc&per_page=3&_embed';
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs populares');
    }
    return respuesta.json() as Promise<Post[]>;
}

export async function obtenerPostsRecientes(): Promise<Post[]> {
    const url = 'https://blog.redflox.com/wp-json/wp/v2/posts?orderby=date&order=desc&per_page=3&_embed';
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs recientes');
    }
    return respuesta.json() as Promise<Post[]>;
}

export async function obtenerPostsPorBusqueda(busqueda: string, page = 1, per_page = 10): Promise<Post[]> {
  const url = `https://blog.redflox.com/wp-json/wp/v2/posts?search=${busqueda}&_embed&page=${page}&per_page=${per_page}`;
  const respuesta = await fetch(url);
  if (!respuesta.ok) {
    throw new Error('Error al recuperar los blogs');
  }
  return respuesta.json() as Promise<Post[]>;
}

export async function obtenerPostsPorPagina(pagina: number = 1, postPorPagina: number = 10): Promise<Post[]> {
    const url = `https://blog.redflox.com/wp-json/wp/v2/posts?per_page=${postPorPagina}&page=${pagina}&_embed`;
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs');
    }
    return respuesta.json() as Promise<Post[]>;
}

export async function obtenerNumeroDePaginas(postPorPagina: number = 10): Promise<number> {
    const url = `https://blog.redflox.com/wp-json/wp/v2/posts?per_page=${postPorPagina}`;
    const respuesta = await fetch(url);
    if (!respuesta.ok) {
        throw new Error('Error al recuperar los blogs');
    }
    const headers = respuesta.headers;
    const totalPosts = headers.get('X-WP-Total');
    const totalPages = headers.get('X-WP-TotalPages');
    if (totalPosts === null || totalPages === null) {
        throw new Error('Error al recuperar los blogs');
    }
    return parseInt(totalPages);
}
---